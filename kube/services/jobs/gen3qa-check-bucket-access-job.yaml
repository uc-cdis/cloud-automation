apiVersion: batch/v1
kind: Job
metadata:
  name: gen3qa-check-bucket-access
spec:
  template:
    metadata:
      labels:
        app: gen3job
    spec:
      containers:
      - name: gen3qa-check-bucket-access
        GEN3_GEN3_QA_CONTROLLER_IMAGE|-image: quay.io/cdis/gen3-qa-controller:0.1-|
        imagePullPolicy: Always
        env:
          - name: INDEXD_QUERY_FILTER
            GEN3_INDEXD_QUERY_FILTER|-value: "all"-|
          - name: ACCESS_TOKEN
            GEN3_ACCESS_TOKEN|-value: ""-|
        command: ["/bin/sh"]
        args:
          - "-c"
          - |
            set +x
            echo "running checkAllProjectsGoogleBucketAccessTest.js..."
            INDEXD_FILTER=$INDEXD_QUERY_FILTER GEN3_SKIP_PROJ_SETUP=true RUNNING_LOCAL=true npm test -- suites/google/checkAllProjectsGoogleBucketAccessTest.js
            RC=$?
            if [[ $RC != 0 ]]; then
              echo "ERROR: non zero exit code: $?"
            fi
      restartPolicy: Never