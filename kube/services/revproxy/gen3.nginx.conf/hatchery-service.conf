
          location /lw-workspace/ {
              auth_request /authn-proxy;
              auth_request_set $remoteUser $upstream_http_REMOTE_USER;

              proxy_set_header REMOTE_USER $remoteUser;
              error_page 403 = @errorworkspace;

              # Use this variable so nginx won't error out on start
              # if not using the jupyterhub service
              # this isn't dev namespace friendly, must be manually updated
              set $proxy_service  "hatchery";
              set $upstream_h http://hatchery-service.$namespace.svc.cluster.local;
              rewrite ^/lw-workspace/(.*) /$1 break;
              proxy_pass $upstream_h;
              proxy_set_header Authorization "$access_token";
              proxy_set_header Host $host;
              proxy_set_header X-Real-IP $remote_addr;
              proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
              proxy_set_header Upgrade $http_upgrade;
              proxy_set_header Connection $connection_upgrade;
              client_max_body_size 0;
          }
