location /funnel/ {
    if ($csrf_check !~ ^ok-\S.+$) {
      return 403 "failed csrf check";
    }

    set $proxy_service  "funnel";
    set $upstream http://funnel-service.$namespace.svc.cluster.local;
    rewrite ^/funnel/(.*) /$1 break;
    proxy_pass $upstream;

    # no limit to payload size so we can upload large DICOM files
    client_max_body_size 0;
}
