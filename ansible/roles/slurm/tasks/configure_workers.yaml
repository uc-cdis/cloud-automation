---
- name: nodejs repo
  shell: -sL https://deb.nodesource.com/setup_{{ nodejs_version }} | sudo -E bash -
  environment:
    http_proxy: "{{ http_proxy }}:{{ http_proxy_port }}"
    https_proxy: "{{ https_proxy }}:{{ https_proxy_port }}"


- name: "worker packages"
  apt:
    name: '{{ item }}'
    state: present
    update_cache: yes
  loop:
    - s3cmd
    - libpq-dev
    - python-dev
    - nodejs

- name: /usr/local/etc/gres.conf
  template:
    src: gres.conf.j2
    dest: /usr/local/etc/gres.conf
    owner: slurm
    group: slurm
    

- name: docker_opts
  lineinfile:
    path: /etc/default/docker
    line: DOCKER_OPTS="-g /mnt/docker-images --log-driver=json-file --log-opt labels=production_status --log-opt env=os,customer --log-opt max-size=10m --log-opt max-file=10"

- name: docker_tmp
  lineinfile:
    path: /etc/default/docker
    line: export TMPDIR="/mnt/docker-tmp"


